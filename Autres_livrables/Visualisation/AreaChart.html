<!DOCTYPE html>
<html>
<head>
  <title>Area Chart</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">

    <script src="https://d3js.org/d3-color.v2.min.js"></script>
<script src="https://d3js.org/d3-interpolate.v2.min.js"></script>
<script src="https://d3js.org/d3-scale-chromatic.v2.min.js"></script>


  <script src="https://d3js.org/d3.v6.js"></script>
<style>

  div.tooltip {
    position: absolute;
    text-align: center;
    color: black;
    padding:4px;
    width: 90px;
    height: 47px;
    font: 15px sans-serif;
    pointer-events: none;
}


</style>
</head>
<body>




<!-- Create a div where the graph will take place -->
<div id="my_dataviz">
  
</div>

<script>

// set the dimensions and margins of the graph
var margin = {top: 100, right: 60, bottom: 100, left: 60},
    width = 1200 - margin.left - margin.right,
    height = 800 - margin.top - margin.bottom;

var widthrect=200
// append the svg object to the body of the page
var svg = d3.select("#my_dataviz")
  .append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
    .append("g")
    .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")");


svg.append("rect")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
    .attr("fill","white")
    .attr("stroke-width",1)
    .attr("stroke","black")
    .attr("x",-margin.left).attr("y",-margin.top)


//Read the data

var data=[{year:2010, value:Math.random()*10},{year:2011, value:Math.random()*10},{year:2012, value:Math.random()*10},{year:2013, value:Math.random()*10},{year:2014, value:Math.random()*10},{year:2015, value:Math.random()*10},{year:2016, value:Math.random()*10},{year:2017, value:Math.random()*10},{year:2018, value:Math.random()*10},{year:2019, value:undefined},{year:2020, value:undefined},{year:2021, value:Math.random()*10}]

var data2=[{year:2010, value:Math.random()*10},{year:2011, value:Math.random()*10},{year:2012, value:Math.random()*10},{year:2013, value:Math.random()*10},{year:2014, value:Math.random()*10},{year:2015, value:Math.random()*10},{year:2016, value:Math.random()*10},{year:2017, value:Math.random()*10},{year:2018, value:Math.random()*10},{year:2019, value:Math.random()*10},{year:2020, value:Math.random()*10},{year:2021, value:Math.random()*10}]



var domain=d3.extent(data, function(d){return d.year})
domain[0]-=0.5
domain[1]+=0.5


//try missing values chart
data.unshift({year:domain[0], value:(data[0].value+5)/2})
data.push({year:domain[1], value:(data[data.length-1].value+5)/2})


var X= d3.scaleLinear()
      .domain(domain)
      .range([0, width])

var xaxis=svg.append("g")
  .attr("transform", "translate(0," + height + ")")
  .call(d3.axisBottom(X).ticks(10))

var Y = d3.scaleLinear()
  .domain([0, 2+d3.max(data, function(d) { return d.value; })])
  .range([ height, 0 ]);
var yaxis=svg.append("g")
  .call(d3.axisLeft(Y));


var div = d3.select("body").append("div")   
    .attr("class", "tooltip")               
    .style("opacity", 0 )
    .style("width",2*X(2010))
    .style("background","black")
    .style("color", "white");


//var line=svg.append("path").attr("d", d3.line()([ [40, 90], [60, 10], [190, 10]])).attr("fill", "none").attr("stroke", "steelblue").attr("stroke-width", 1.5)

    // svg.append("path")
    //   .datum(data)
    //  .attr("fill", "steelblue")
    //  .attr("fill-opacity", 0.2)
    //  .attr("stroke", "steelblue")
    //  .attr("stroke-width", 1.5)
    //  .attr("stroke-linejoin", "round")
    //  .attr("stroke-linecap", "round")
    //   .attr("stroke", "steelblue")
    //   .attr("stroke-width", 1.5)
    //   .attr("d", d3.line()
    //     .x(function(d) { return X(d.year) })
    //     .y(function(d) { return Y(d.value) })
    //     )
area0=d3.area()
      .defined(d => !isNaN(d.value))
        .x(function(d) { return X(d.year) })
        .y0(Y(0))
        .y1(function(d) { return Y(0) })



area=d3.area()
        .defined(d => !isNaN(d.value))
        .x(function(d) { return X(d.year) })
        .y0(Y(0))
        .y1(function(d) { return Y(d.value) })

    svg.append("path")
      .datum(data.filter(area.defined()))
       .attr("fill", "white")
       .attr("fill-opacity", 0.2)
       .attr("stroke", "steelblue")
       .attr("stroke-width", 1.5)
       .attr("stroke-linejoin", "round")
       .attr("stroke-linecap", "round")
        .attr("stroke", "steelblue")
        .attr("stroke-width", 1.5)
        .attr("d", area0)
        .transition().duration(500)
        .attr("d",area)

    svg.append("path")
      .datum(data)
       .attr("fill", "steelblue")
       .attr("fill-opacity", 0.2)
       .attr("stroke", "steelblue")
       .attr("stroke-width", 1.5)
       .attr("stroke-linejoin", "round")
       .attr("stroke-linecap", "round")
        .attr("stroke", "steelblue")
        .attr("stroke-width", 1.5)
        .attr("d", area0)
        .transition().duration(500)
        .attr("d",area)




 svg.append("g").selectAll("circle")
  .data(data.filter(area.defined()))
  .enter()
  .append("circle")
    .attr("cx", function(d){return X(d.year)})
    .attr("cy",function(d){return Y(d.value)})
    .attr("r",3)
    .attr("fill","steelblue")
    .style("stroke", "gray")

 svg.append("g").selectAll("rect")
  .data(data)
  .enter()
  .append("rect")
  .attr("id",function(d){return d.year})
  .attr("x", function(d,i){
          if (i==0||i==data.length-1) return X(d.year)+0
          else {return X(d.year-0.5)}})
    .attr("y", 0)
    .attr("width", function(d,i){if (i==0||i==data.length-1) {return 0}
                                  else {return 2*X(2010)}})
    .attr("height", height)
    .attr("stroke-width",0)
    .attr("fill","white")
    .attr("fill-opacity",0.1)
    .style("stroke", "steelblue")
    .attr("stroke-width",1)
    .attr("stroke-opacity",0)
    .on("mouseover",function(d,i){
      if(i.value!=undefined){

          d3.select(this).attr("stroke-opacity",0.3).attr("fill","steelblue")
                    .attr("fill-opacity",0.2)
          div.style("opacity", 1)

              div.html("En " +i.year +" : <br>"+ i.value.toPrecision(2))  
                  .style("left", X(i.year)+15+"px") 
                  .style("top", margin.top+"px")
                 }} )   
          // tooltip.attr("opacity",1).transition('r')
          // .attr("x",(width-widthrect)/2)
          // .attr("y", 0.1*height)}) 


    .on("mouseout",function(d,i){
          d3.select(this).attr("fill-opacity",0.1).attr("stroke-opacity",0).attr("fill","white")
          div.style("opacity",0)})




</script>
</body>
</html>
