<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Composition revenus</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
  <style>


</style>
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <script src="https://d3js.org/d3-color.v2.min.js"></script>
<script src="https://d3js.org/d3-interpolate.v2.min.js"></script>
<script src="https://d3js.org/d3-scale-chromatic.v2.min.js"></script>


</head>
<body>

  <h1 class="m-5 text-center">Pie Chart</h1>


<script>

//Initialisation de variables
var width = 600
var height = 400
var zoomed=0
var zoomed2=0
opacity="0%"
var decx=200;
var decy=200;


/*var zoom = d3.zoom() 
  .scaleExtent([1, 10]) 
  .translateExtent([[10, 10], [width, height]]) 
  .on("zoom", zoomed); 
*/


//Création du svg1
var svg= d3.select("body").append("svg")
	.attr("width", width)
	.attr("height", height)
	.attr("id", "demo")
	.style("stroke", "black")
	.call(d3.zoom().on("zoom", function () { 
    	svg.attr("transform", d3.event.transform) 
    	 }))
	.on("click", clicked1);


//Création du svg2
var svg2= d3.select("body").append("svg")
	.attr("width", width)
	.attr("height", height)
	.attr("id", "demo2")
	.style("stroke", "black")
	.call(d3.zoom().on("zoom", function () { 
    	svg2.attr("transform", d3.event.transform) 
    	 }))
	.on("click", clicked2);

//initialisation du point de départ des svg
d3.select("#demo")
	.append("g")
	.attr('transform', "translate(200,200)");

d3.select("#demo2")
	.append("g")
	.attr('transform', "translate(200,200)");



//Fonction de zoom en cliquant sur les svg et apparition des textes
function clicked1(d) {
  var x, y, k, opacity;


// si le svg n'est pas zoomé, alors on zoom
if(zoomed==0){
	k=3;
	x=800;
	y=250;
	opacity="100%"
	opacityb="5%"

	zoomed=1;
}
// sinon on revient à la position initiale
else{
	opacity="0%"
	opacityb="100%"
	x=0
	y=0;
	k=1;
	zoomed=0
}

  svg.transition()
      .duration(750)
      .attr("transform", "translate(" + x + "," + y + ")scale(" + k + ")")
      .style("stroke-width", 1/k + "px")

    svg.selectAll("#legend").transition(10000).attr("opacity", opacity);
	svg2.transition()
	.duration(750).attr("opacity",opacityb)
}

function clicked2(d) {
  var x, y, k, opacity;


// si le svg n'est pas zoomé, alors on zoom
if(zoomed2==0){
	k=3;
	x=200;
	y=250;
	opacity="100%"
	opacityb="5%"
	zoomed2=1;
}
// sinon on revient à la position initiale
else{
	x=0;
	y=0;
	k=1;
	zoomed2=0
	opacity="0%"
	opacityb="100%"
}

  svg2.transition()
      .duration(750)
      .attr("transform", "translate(" + x  + "," + y + ")scale(" + k + ")")
      .attr()
      .style("stroke-width", 1/k + "px");

 svg2.selectAll("#legend").transition(10000).attr("opacity", opacity);
svg.transition()
	.duration(750).attr("opacity",opacityb)

}



// Générateur des arcs
var arcGen = d3.arc()
	.innerRadius(50)
	.outerRadius(90);

//Création des echelles de couleurs pour les pie chart
var colorScale = d3.scaleSequential(d3.interpolate("purple", "orange")).domain([100,1000]);

var colorScale2 = d3.scaleSequential(d3.interpolate("yellow","orange","green")).domain([100,500,600, 900, 1000]);



//Génération des pie chart
var angleGen = d3.pie()
.value((d)=> d.size)
.padAngle(.08);



//Création des jeux de données pour les pie chart
var input = [
{name: "Vente", size : "1000"},
{name: "Apport financier", size: "200"},
{name: "Revenu non agricole", size: "300"}
]
input.title="Composition des revenus"



var output = [
{name: "Consommation intermediaire", size : "2000"},
{name: "Salaire", size: "700"},
{name: "Consommation intermediaires", size : "950"},
{name: "Salairse", size: "250"},
{name: "Investissemenst", size: "300"}
]
output.title="Composition des dépenses"



//Générateur d'angles en fonction des donénes
var data = angleGen(input);
var data2 = angleGen(output);


//Titre du pie chart
d3.select("#demo").append("text")
	.data(input)
	.text(input.title)
	.attr("x", decx)
	.attr("y", "70")
    .attr("text-anchor", "middle")
    .attr("font-size", "20px")
    .style("color","black")
    .attr("stroke-width", "0.2px")



//Titre du pie chart

 d3.select("#demo2").append("text")
	.text(output.title)
	.attr("x", decx)
	.attr("y", "70")
    .attr("text-anchor", "middle")
    .attr("font-size", "20px")
    .style("color","black")
    .attr("stroke-width", "0.2px")


//Génération des parts du pie chart et coloration
d3.select("#demo")
	.select("g")
	.selectAll("path")
	.data(data)
	.enter()
	.append("path")
	.attr("d", arcGen)
	.attr("fill", (d) => colorScale(d.value))	; 



d3.select("#demo2")
	.select("g")
	.selectAll("path")
	.data(data2)
	.enter()
	.append("path")
	.attr("d", arcGen)
	.attr("fill", (d) => colorScale2(d.value))
	;



//Legendes
  d3.select("#demo")
    .selectAll("newText")
    .data(data)
    .enter()
    .append("text")
    .attr("id", "legend")
    .attr("x", d => d3.pointRadial((d.startAngle + d.endAngle  - 0.1)/2 , (100+90)/2)[0])
    .attr("y", d => d3.pointRadial((d.startAngle + d.endAngle  - 0.1)/2 , (100+90)/2)[1]-5)
    .attr("text-anchor", "middle")
    .text(d => d.data.name)
    .attr("font-size", "15px")
    .style("color","black")
    .attr("stroke-width", "0.2px")
    .attr("fill", "black")
    .attr("transform","translate(200,200)")
    .attr("opacity", opacity);

//Legendes
  d3.select("#demo")
    .selectAll("newText")
    .data(data)
    .enter()
    .append("text")
    .attr("id", "legend")
    .attr("x", d => d3.pointRadial((d.startAngle + d.endAngle  - 0.1)/2 , (100+90)/2)[0])
    .attr("y", d => d3.pointRadial((d.startAngle + d.endAngle  - 0.1)/2 , (100+90)/2)[1]+10)
    .attr("text-anchor", "middle")
    .text(d => d.data.size)
    .attr("font-size", "10px")
    .style("color","black")
    .attr("stroke-width", "0.2px")
    .attr("fill", "black")
    .attr("transform","translate(200,200)")
    .attr("opacity", opacity);









  d3.select("#demo2")
    .selectAll("newText")
    .data(data2)
    .enter()
    .append("text")
    .attr("id", "legend")
    .attr("x", d => d3.pointRadial((d.startAngle + d.endAngle  - 0.1)/2 , (100+90)/2)[0])
    .attr("y", d => d3.pointRadial((d.startAngle + d.endAngle  - 0.1)/2 , (100+90)/2)[1]-5)
    .attr("text-anchor", "middle")
    .text(d => d.data.name)
    .attr("font-size", "15px")
    .style("color","black")
    .attr("stroke-width", "0.2px")
    .attr("fill", "black")
    .attr("transform","translate(200,200)")
    .attr("opacity", opacity);

d3.select("#demo2")
    .selectAll("newText")
    .data(data2)
    .enter()
    .append("text")
    .attr("id", "legend")
    .attr("x", d => d3.pointRadial((d.startAngle + d.endAngle  - 0.1)/2 , (100+90)/2)[0])
    .attr("y", d => d3.pointRadial((d.startAngle + d.endAngle  - 0.1)/2 , (100+90)/2)[1]+10)
    .attr("text-anchor", "middle")
    .text(d => d.data.size)
    .attr("font-size", "10px")
    .style("color","black")
    .attr("stroke-width", "0.2px")
    .attr("fill", "black")
    .attr("transform","translate(200,200)")
    .attr("opacity", opacity);


</script>



</body>
</html>

