<!DOCTYPE html> 
<html> 

<head> 
	<meta charset="utf-8"> 
	<script src= 
"https://cdnjs.cloudflare.com/ajax/libs/d3/4.2.2/d3.min.js"> 
	</script> 
	<script src= 
		"https://d3js.org/d3.v6.min.js"> 
	</script> 

<style>

  svg {

    padding: 20px;
    font: 15px sans-serif;
    background: #48707B;
    border: 100px;
    stroke-width: 1px;
    width:100%;
    height:100%;

}

</style>

</head> 

<body> 
	<h1 style="text-align:center; color:green;"> 
		GeeksforGeeks 
	</h1> 
	
	<center> 
	</center> 

	<script> 

 const width=1300
 const height=800
var size=200
var click=[1,1,1,1,1]
var click2=[1,1,1,1,1]
var clickdetails=0

//Transformation des données pour utiliser le lineradial
//L'ensemble data contient les angle puis les distances
function getData(length, values){
	var data=[]
	for(i=0; i<length+1; i++){
			data.push([(i*2*Math.PI/length)+Math.PI/2, values[i%length]/100*size])
		}
return data;
}


//Création des donénes pour les niveaux d'échelle de pourcentage
function getDataChart(length,percentage=1){
	var data =[]
	for(i=0; i<length+1; i++){
		data.push([(i*2*Math.PI/length)+Math.PI/2, size*percentage])
	}
return data;
}


//Création des données pour la création des axes
function getDataAxes(length){
	var data=[]
	for(i=0; i<length+1; i++){
			data.push([(i*2*Math.PI/length)+Math.PI/2, 1.2*size])
			data.push([0,0])
		}
return data;
}


//Création des niveaux de pourcentage
function getLevel(color, level, length){
		var lineRadialGeneratordata=d3.lineRadial();
		d3.select("#gfg") 
		.select("g") 
		.append("path") 
		.attr("d", lineRadialGeneratordata(getDataChart(length, level))) 
		.attr("fill", "none") 
		.attr("stroke", color )
		.attr("stroke-width","0.35px"); 
}

//Création de l'étoile puis des échelles de pourcentage
function getScale(length){
	var lineRadialGeneratordata=d3.lineRadial();
	d3.select("#gfg") 
		.select("g") 
		.append("path") 
		.attr("d", lineRadialGeneratordata(getDataAxes(length)) )
		.attr("stroke", "black")
		.attr("stroke-width","0.5px"); 


		colors=["black","red", "orange","green"];
		levels=[0.4,0.6,0.8, 1]

		for(l=0; l<colors.length; l++){
			getLevel(colors[l], levels[l], length)
		}

}



//ajout des différentes valeurs sur chaque axe
function addData(value, color){
	var lineRadialGeneratordata=d3.lineRadial();
	d3.select("#gfg") 
		.select("g") 
		.append("path")
		.attr("id", color)//ajouter transition de style au démarrage
		.on("mouseover", function(){
			d3.select(this).transition().duration(100).attr("fill-opacity",0.75).attr("stroke-opacity",1)
		})
		.on("mouseout", function(){
			d3.select(this).transition().duration(200).attr("fill-opacity",0.32).attr("stroke-opacity",0.8)
		})
		.attr("d", lineRadialGeneratordata(getData(length, [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]))) 
		.transition("r").duration(1000)
		.attr("d", lineRadialGeneratordata(getData(length, value))) 
		.attr("fill", color) 
		.attr("stroke", color)
		.attr("stroke-width","2px")
		.attr("fill-opacity", 0.2)
		.attr("stroke-opacity",0.8);
}

/*
function hideData(color){
		var lineRadialGeneratordata=d3.lineRadial();
	d3.select("#gfg") 
		.select("g") 
		.select("path#color")
		.transition().duration(1000)
		.attr("d", lineRadialGeneratordata(getData(9, [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]))) 

}*/


function getTitles(length){
	var titles=[];
		for(c=0; c<length; c++){
		titles[c]="Axe "+(c+1);
	}
	return titles;
}


function addTitles(titles){

	var locations=[]
	for(k=0; k<length; k++){
			locations.push([Math.cos(2*Math.PI*k/titles.length)*(size*1.5) ,Math.sin(2*Math.PI*k/titles.length)*(1.5*size)])
		}
var g=d3.select("svg").select("g")

	for(let i=0; i<titles.length; i++){
			g.append("text").text(titles[i])

				.attr("x", locations[i][0])
				.attr("y", locations[i][1])
				.attr("font-size","20px")
				.attr("text-anchor", "middle")
	}
return;
}




function getTips(){
	var legendScale = d3.scaleLinear()
    .domain([0, 100])
    .range([0, size]);

    var legendAxis = d3.select("svg").append("g")
    .attr('transform', 'translate('+2*size +","+ 1.9*size +")")
    .call(d3.axisBottom(legendScale).ticks(6));
}


function getLegend(tabValues_length){
	var legendes=[];
		for(let c=0; c<tabValues_length; c++){
		legendes[c]="Données exploitation "+(c+1);
	}
	return legendes;
}


function dataSelection(tab, legend, color){

	var g =d3.select("svg").append("g")
		g.append("text").attr("id","detailstitre")
			.text("Choix des données")
			.attr("x",width-size)
			.attr("y",1.65*size)
			.attr("font-size","35px")
			.attr("text-anchor",'middle')

	for(let i=0; i<tab.length; i++){
		g.append("rect")
			.attr("x",width-1.6*size)
			.attr("y", 2*size+80*i)
			.attr("height",20)
			.attr("width",20)
			.attr("fill",color[i])
			.attr("stroke", color[i])
			.attr("stroke-width", "2px")
			.attr("stroke-opacity",0.8)
			.attr("fill-opacity",0.6)
			.on("click", function(){
				if(click[i]==0){
					d3.select(this).attr("fill-opacity",0.8)
					d3.select("svg").select("path#"+ color[i]).remove()
					addData(tab[i], color[i])
					click[i]=1
				}
				else if(click[i]==1){
					d3.select(this).attr("fill-opacity",0.2)
					d3.select("svg").select("path#"+ color[i]).remove()
					//hideData(color[i])
					click[i]=0
				}
			});

			g.append("text")
			.text([legend[i]])
			.attr("x",width-1.6*size+45)
			.attr("y",2*size+80*i+15)


	}
}

function graphSelection(){

	var g=d3.select("svg").append("g")
	g.append("text").attr("id","detailstitre")
			.text("Choix du graphe")
			.attr("x",width-size)
			.attr("y",	0.35* size)
			.attr("font-size","35px")
			.attr("text-anchor",'middle')
	g.append("text").attr("id","details")
			.text("Plus de détails")
			.attr("x",width-1.6*size+40)
			.attr("y",0.7*size+15)


		g.append("rect")
		.attr("id","details")
			.attr("x",width-1.6*size)
			.attr("y",0.7*size)
			.attr("height",20)
			.attr("width",20)
			.attr("fill","grey")
			.attr("stroke", "black")
			.attr("stroke-width", "2px")
			.on("click", function(){
				if(clickdetails==0){
					d3.select("svg").remove()
					getRadarChart(ValuesDetails[0], ValuesDetails[1], ValuesDetails[2])
					d3.select("svg").selectAll("g").select("text#details").text("Moins de détails")
					d3.select("svg").selectAll("g").select("rect#details").attr("fill","black")
					clickdetails=1;
					click=[1,1,1,1,1,1,1]
			}
				else if(clickdetails==1){
					d3.select("svg").remove()
					getRadarChart(Values2[0], Values2[1], Values2[2])
					d3.select("svg").selectAll("g").select("text#details").text("Plus de détails")
					d3.select("svg").selectAll("g").select("rect#details").attr("fill","white")
					clickdetails=0;
					click=[1,1,1,1,1,1,1]
			}
			})
}



//Générer automatiquement un radarchart à partir d'un ensemble de liste de valeurs de même taille 
function getRadarChart(tabValues, titles, legends){

		length=tabValues[0].length
	if(legends!=null && legends.length!=tabValues.length){
		alert("Il faut autant de légendes que d'ensembles de données")
		return 
	}


	for(i=0; i<tabValues.length; i++){
		if(tabValues[i].length!==tabValues[0].length || (titles!=null && titles.length!=tabValues[0].length)){
			alert("les ensemble doivent être de même taille")
			return; 
		}
	}

var svg=d3.select("center").append("svg")
		.attr("id", "gfg")
		.attr("width", width)
		.attr("height", height)
		.style("background","white")

var cadre=svg.append("rect")
		.attr("width", width)
		.attr("height", height)
		.attr("fill","white")
		.attr("stroke", "black")

var cadre2=svg.append("rect")
	.attr("id","graphSelect")
		.attr("width", size*2)
		.attr("height", height/3)
		.attr("x", width-2*size)
		.attr("fill","white")
		.attr("stroke", "black")

var cadre2=svg.append("rect")
	.attr("id","dataSelect")
		.attr("width", size*2)
		.attr("height", 2*height/3)
		.attr("x", width-2*size)
		.attr("y", height/3)
		.attr("fill","white")
		.attr("stroke", "black")



var g=d3.select("svg").append("g").attr("transform","translate("+2*size +","+ 1.9*size +")")


	getScale(length);


	for(j=0; j<tabValues.length; j++){
		addData(tabValues[j],color[j])
	}

	//getTitles()

if (titles==null){
	var titles=getTitles(tabValues[0].length)
}

if(titles!=null){
	addTitles(titles)
}

if(legends==null){
	var legends=getLegend(tabValues.length)
}
/*
if(legends!=null){
	addLegend(legends);
}*/

dataSelection(tabValues,legends,color);
graphSelection();




getTips();
}


var values1=[Math.random()*100,Math.random()*100,Math.random()*100,Math.random()*100,Math.random()*100,Math.random()*100,Math.random()*100,
Math.random()*100,Math.random()*100,Math.random()*100,Math.random()*100,Math.random()*100,Math.random()*100,Math.random()*100,Math.random()*100]
var values2=[Math.random()*100,Math.random()*100,Math.random()*100,Math.random()*100,Math.random()*100,Math.random()*100,Math.random()*100,
Math.random()*100,Math.random()*100,Math.random()*100,Math.random()*100,Math.random()*100,Math.random()*100,Math.random()*100,Math.random()*100]
var values3=[Math.random()*100,Math.random()*100,Math.random()*100,Math.random()*100,Math.random()*100,Math.random()*100,Math.random()*100,
Math.random()*100,Math.random()*100]
var values4=[Math.random()*100,Math.random()*100,Math.random()*100,Math.random()*100,Math.random()*100,Math.random()*100,Math.random()*100,
Math.random()*100,Math.random()*100]
var values5=[Math.random()*100,Math.random()*100,Math.random()*100,Math.random()*100,Math.random()*100,Math.random()*100,Math.random()*100,
Math.random()*100,Math.random()*100]
var values6=[Math.random()*100,Math.random()*100,Math.random()*100,Math.random()*100,Math.random()*100,Math.random()*100,Math.random()*100,
Math.random()*100,Math.random()*100]




categories=["Produit brut", "VAB","Capital", "Travail feminin", "Travail enfant", "Capital","VAB par capital", "Surface", "VAB par surface", "Main d'oeuvre", "VAB par main d'oeuvre", "Production bio", "Utilisation d'engrais", "Subvention","Entraide"]//,"Organisation producteurs"]

categories2=["Produit brut", "VAB","Capital", "Travail feminin", "Travail enfant", "Capital","VAB par capital", "Surface", "VAB par surface"]
legendes=["Exploitation des Hoareau","Moyenne territoriale"]
color=["red","blue","green","orange","yellow"]


//getRadarChart([values, values2], categories, legendes);

//getRadarChart([values3, values4], categories2, legendes)

var values3b=[Math.random()*100,Math.random()*100,Math.random()*100,Math.random()*100,Math.random()*100,Math.random()*100,Math.random()*100,
Math.random()*100,Math.random()*100]
var values4b=[Math.random()*100,Math.random()*100,Math.random()*100,Math.random()*100,Math.random()*100,Math.random()*100,Math.random()*100,
Math.random()*100,Math.random()*100]
var values5b=[Math.random()*100,Math.random()*100,Math.random()*100,Math.random()*100,Math.random()*100,Math.random()*100,Math.random()*100,
Math.random()*100,Math.random()*100]
var values6b=[Math.random()*100,Math.random()*100,Math.random()*100,Math.random()*100,Math.random()*100,Math.random()*100,Math.random()*100,
Math.random()*100,Math.random()*100]


var ValuesDetails=([[values1, values2], categories, legendes])
var Values=([[values3, values4], categories2, legendes])
var Values2=([[values4, values5, values6], categories2, null])

getRadarChart(Values2[0], Values2[1], Values2[2])

	</script> 
</body> 

</html> 
